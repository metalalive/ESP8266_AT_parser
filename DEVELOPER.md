# Development Guide


### Brief introduction of software design of this AT-command parser

This ESP AT-command parser runs with 2 seperate tasks (threads), and one interrupt service routine (ISR in short) :
* Request-handling task : handles incoming AT command request sent by API calls, generates low-level command raw bytes and then send then out to ESP8266 device.
* Response-handling task : processes raw response string received from ESP8266 device, extracts meaningful data from the received string, and pass them back to API function calls.
* ISR : when the AT-command raw bytes are transmitted to ESP device, our parsing software will wait until the ESP device transmits  variable number of bytes as response of the AT command back to host CPU, as soon as number of raw bytes (part of response data) are ready in the DMA Rx buffer of the underlying hardware platform, the DMA is expected to signal interrupt to the host CPU, then the host CPU switches to the ISR, starts copying the received raw bytes from DMA Rx buffer to the buffer structure internally defined / used in this ESP AT parser, let the response-handling task process the raw bytes later.

The ISR works closely with the 2 tasks, and it communicates with DMA (Direct Memory Access controller) / UART modules, which are essential in your underlying hardware platform.


### Code Structure
| path of folders | description |
|-----------------|-------------|
| `Src/ESP_AT_parser/inc/esp`  | core functions, API functions, macros, data structure are declared at here |
| `Src/ESP_AT_parser/inc/system` | system ports for underlying OS platform. |
| `Src/ESP_AT_parser/src/esp` | core functions implementation | 
| `Src/ESP_AT_parser/src/api` | API functions implementation |
| `Src/ESP_AT_parser/src/system` | system ports implementation |


### Basic usage 
Here is quick overview of the API functions which would be called in user applications :
* ```espRes_t   eESPinit( espEvtCbFn cb )``` : Initialize ESP AT-command parser, this function creates threads that work together to handler AT command requests generated by other API functions call, also a couple of data structure for internal use like mutex, semaphore (for thread synchronization), and message boxes (for communication between these threads). Where ```espEvtCbFn cb``` is an event callback that is globally used in this AT-command parser
  
* ```espRes_t    eESPresetWithDelay( uint32_t dly_ms, const espApiCmdCbFn cb , void* const cb_arg )``` : reset ESP device with given milliseconds. The optional arguments ```espApiCmdCbFn cb``` and ```void* const cb_arg ``` are API callback function pointer and the callback's argument, they take effect after reset is done.

* ```espRes_t  eESPsetWifiMode( espMode_t mode, uint8_t saveDef, const espApiCmdCbFn cb, void* const cb_arg, const uint8_t blocking )``` :  turn on station mode, or Access-Point mode (or both) in the target ESP device, where ```espApiCmdCbFn cb```, ```void* const cb_arg``` are API callback & associated arguments, note that most of API functions have these 2 arguments, they work the same way.

* ```espRes_t  eESPstaListAP(const char* ssid, uint16_t  ssid_len, espAP_t* aps, uint16_t apslen, uint16_t* num_ap_found,  const espApiCmdCbFn cb, void* const cb_arg, const uint32_t blocking)``` : scan and list other wifi Access-Points around the ESP device, copy the list to the given structure `aps` and number of APs found `num_ap_found`.

* ```espRes_t  eESPstaJoin(const char* ssid, uint16_t ssid_len, const char* pass, uint16_t pass_len, const espMac_t* mac,  uint8_t saveDef, const espApiCmdCbFn cb, void* const cb_arg, const uint32_t blocking)``` : connect to the Access-Point with given `ssid`, and password `pass`.

* ```espRes_t   eESPstaQuit(const espApiCmdCbFn cb, void* const cb_arg, const uint32_t blocking)``` : quit from the Access-Point this ESP device connected to in the last time.

* ```espRes_t   eESPconnClientStart( espConn_t *conn_in, espConnType_t type, const char* const host, uint16_t host_len, espPort_t port, espEvtCbFn evt_cb,  espEvtCbFn api_cb,  void* const api_cb_arg,  const uint32_t blocking )``` : start new TCP/UDP connection (specified in `type`) to a given remote IP `host` , the port `port`, and specify connection ID in `conn_in` that hasn't been used as an established TCP/UDP connection.

* ```espRes_t eESPconnClientClose( espConn_t *conn_in, espEvtCbFn api_cb,  void* const api_cb_arg, const uint32_t blocking)``` : close a TCP/UDP connection established before, the with given connection ID managed inside ESP device.

* ```espRes_t       eESPconnClientSend( espConn_t *conn, const uint8_t *data, size_t d_size, espEvtCbFn cb, void* const cb_arg, const uint32_t blocking)``` send  raw data bytes through the established TCP/UDP connection (specified in `espConn_t *conn`).



### Macros to declare in each platform
Here are the macros you must declare if you integrated this ESP AT-command parser with other platforms / operating system environment.


### Low-level system functions to port
Here are the functions you must implement if you integrated this ESP AT-command parser with other platforms / operating system environment .




